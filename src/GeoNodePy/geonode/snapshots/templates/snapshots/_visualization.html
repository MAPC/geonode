
{% if visualizations.0 %}

	<div class="data_set_list_item">
		<div class="data_set_list_item_header">
			<span class="title">{{ topic.title }}</span> <a href="{{ topic.slug }}" class="link">View All</a>
		</div>
							
		<!-- data_vis -->
		<div class="data_vis">
			<div class="data_vis_pad">
				<div id="{{ topic.slug }}-meta" class="data_vis_header">
					<div class="title"><a href="">{{ visualizations.0.title }}</a></div>
					<div class="info">Year(s): {{ visualizations.0.year }}  <span class="spacer">&#8226;</span>  Source: {% for source in visualizations.0.source.all %}<a href="{{ source.url }}" target="_blank" >{{ source.title }}</a>{% endfor %}</div>
				</div>
				<div class="data_vis_tabs">
					<div id="tabs-1">

						<div id="{{ topic.slug }}">
							<!-- TODO: add thumbnail -->
							<p>Please install Adobe Flash to be able to see this visualization.</p>
						</div>

						<script type="text/javascript">
							
							jQuery(document).ready(function($) {

								pagevis["{{ topic.slug }}"] = {
									visid: {{ visualizations.0.id }},
									loaded: false
								}

								// FlashVars and attributes
								MBDC.swfobject.vis["{{ topic.slug }}"] = {
									flashvars: {
										file: "{{ SITEURL|slice:':-1' }}{% url geonode.snapshots.views.get_sessionstate regiontype.slug regionalunit.slug visualizations.0.id %}"
									},
									attributes: {
										id: "{{ topic.slug }}",
										name: "{{ topic.slug }}"
									}
								};

								// add Flash object
								swfobject.embedSWF(
									"{{ WEAVE_URL }}weave.swf", 
									"{{ topic.slug }}", 
									"333", "252", 
									"10.0.0",
									"expressInstall.swf", 
									MBDC.swfobject.vis["{{ topic.slug }}"].flashvars, 
									MBDC.swfobject.params, 
									MBDC.swfobject.vis["{{ topic.slug }}"].attributes
								);

								{% for visualization in visualizations %}

									$("#{{ regiontype.id }}{{ regionalunit.id }}{{ visualization.id }}").data("visparams", { 
										topic : "{{ topic.slug }}", 
										url : "{{ SITEURL|slice:':-1' }}{% url geonode.snapshots.views.get_sessionstate regiontype.slug regionalunit.slug visualization.id %}",
										visid : {{ visualization.id }},
										vistitle : "{{ visualization.title }}",
										year : "{{ visualization.year }}",
										sources :  "{% for source in visualization.source.all %} <a href='{{ source.url }}'>{{ source.title }}</a>{% endfor %}"
									});

								{% endfor %}

							});

						</script>
						 
					</div>
				</div>
				<div class="data_vis_selection">
					<select class="vis_change">
						<option>Choose Visualization</option>
						{% for visualization in visualizations %}<option id="{{ regiontype.id }}{{ regionalunit.id }}{{ visualization.id }}" value="{{ visualization.id }}">{{ visualization.title }}</option>{% endfor %}
					</select>
				</div>
				<div class="clear"></div>
			</div>
		</div>
		<!-- /data_vis -->

	</div>

{% endif %}
