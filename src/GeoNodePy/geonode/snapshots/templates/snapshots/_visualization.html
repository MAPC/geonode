
{% if visualizations.0 %}

	<div class="data_set_list_item">
		<div class="data_set_list_item_header">
			<span class="title">{{ topic.title }}</span> <a href="{{ topic.slug }}" class="link">View All</a>
		</div>
							
		<!-- data_vis -->
		<div class="data_vis">
			<div class="data_vis_pad">
				<div id="{{ topic.slug }}-meta" class="data_vis_header">
					<div class="title"><a href="">{{ visualizations.0.title }}</a></div>
					<div class="info">Year(s): {{ visualizations.0.year }}  <span class="spacer">&#8226;</span>  Source: {% for source in visualizations.0.source.all %}<a href="{{ source.url }}" target="_blank" >{{ source.title }}</a>{% endfor %}</div>
				</div>
				<div class="data_vis_tabs">
					<div id="tabs-1">

						<div id="{{ topic.slug }}">
							{% if visualizations.0.id in tn_list %}
							<img class="vistn" src="{{ MEDIA_URL }}snapshots_thumbnails/{{ regiontype.slug }}/{{ regionalunit.slug }}/{{ visualizations.0.id }}.png" width="333" height="252" alt="{{ visualizations.0.title }}" />
							{% endif %}
							<p>Please install the <a href="http://get.adobe.com/flashplayer/">Adobe Flash Player</a> to interact with this visualization.</p>
						</div>

						<script type="text/javascript">
							
							jQuery(document).ready(function($) {

								// FlashVars and attributes
								MBDC.swfobject.vis["{{ topic.slug }}"] = {
									flashvars: {
										file: "{{ SITEURL|slice:':-1' }}{% url geonode.snapshots.views.get_sessionstate regiontype.slug regionalunit.slug visualizations.0.id %}"
									},
									attributes: {
										id: "{{ topic.slug }}",
										name: "{{ topic.slug }}"
									}
								};

								pagevis["{{ topic.slug }}"] = {
									visid: {{ visualizations.0.id }}
								};

								{% if visualizations.0.id not in tn_list %}

								$(".view_print").hide();

								// add Flash object
								swfobject.embedSWF(
									"{{ WEAVE_URL }}weave.swf", 
									"{{ topic.slug }}", 
									"333", "252", 
									"10.0.0",
									"expressInstall.swf", 
									MBDC.swfobject.vis["{{ topic.slug }}"].flashvars, 
									MBDC.swfobject.params, 
									MBDC.swfobject.vis["{{ topic.slug }}"].attributes
								);

								pagevis["{{ topic.slug }}"].loaded = false;

								{% endif %}

								// Flash available
								if (swfobject.getFlashPlayerVersion()["major"] > 0) { 
									$("#{{ topic.slug }} p:first").html("Click image for interactive Weave Visualization.");
								} else {
									// no Flash
									$(".data_vis_selection").hide();
								}

								// visualization switcher
								{% for visualization in visualizations %}
									$("#{{ regiontype.id }}{{ regionalunit.id }}{{ visualization.id }}").data("visparams", { 
										topic : "{{ topic.slug }}", 
										url : "{{ SITEURL|slice:':-1' }}{% url geonode.snapshots.views.get_sessionstate regiontype.slug regionalunit.slug visualization.id %}",
										visid : {{ visualization.id }},
										vistitle : "{{ visualization.title }}",
										year : "{{ visualization.year }}",
										sources :  "{% for source in visualization.source.all %} <a href='{{ source.url }}'>{{ source.title }}</a>{% endfor %}"
									});
								{% endfor %}

							});

						</script>
						 
					</div>
				</div>
				<div class="data_vis_selection">
					<select class="vis_change">
						<option>Choose Visualization</option>
						{% for visualization in visualizations %}<option id="{{ regiontype.id }}{{ regionalunit.id }}{{ visualization.id }}" value="{{ visualization.id }}">{{ visualization.title }}</option>{% endfor %}
					</select>
				</div>
				<div class="clear"></div>
			</div>
		</div>
		<!-- /data_vis -->

	</div>

{% endif %}
