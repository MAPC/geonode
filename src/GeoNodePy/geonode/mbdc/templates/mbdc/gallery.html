{% extends "mbdc/base.html" %}

{% load mbdc_extras %}
{% load pagination_tags %}

{% block body %}

<!-- breadcrumb -->
<div class="breadcrumb">
	<span class="breadcrumb_title">You are here:</span>
    <a class="breadcrumb_link" href="/">Home</a>
    <a class="breadcrumb_link" href="/">Explore Data</a>
    <span class="breadcrumb_current">Visualization Gallery</span>
</div>
<!-- /breadcrumb -->

		
{% get_data_search_bar %}

		
<!-- site_body -->
		<div class="site_body">
			<div class="site_body_pad">
				<!-- page_intro_content -->
				<div class="page_intro_content">
					<div class="page_content_text page_content">
						<h1>Visualization Gallery</h1>
						<p>All the wonderful things users created on this site.</p> 
					</div>
					<div class="clear"></div>
				</div>
				<!-- /page_intro_content -->
				
				
<!-- results_filter_multiline -->
<div class="results_filter results_filter_multiline">
	<div class="results_filter_pad">
		<div class="results_filter_header">
			<div class="title">Filter Title</div>
			<div class="link"><a href="javascript:;">Need Help?</a></div>
			<div class="clear"></div>
		</div>
		<div class="results_filter_form">
			<div class="results_filter_form_pad">
				<div class="filter_form_field">
					<label for="filterSource">Source:</label>
					<select id="filterSource" class="filter_form_field_source">
						<option value="" id="All">All</option>
						
						<option value="option 0">option 0</option>
						
						<option value="option 1">option 1</option>
						
						<option value="option 2">option 2</option>
						
						<option value="option 3">option 3</option>
						
						<option value="option 4">option 4</option>
						
					</select>
				</div>
				
				<div class="filter_form_field">
					<label for="filterTopic">Topic:</label>
					<select id="filterTopic" class="filter_form_field_topic">
						<option value="" id="All">All</option>
						
						<option value="option 0">option 0</option>
						
						<option value="option 1">option 1</option>
						
						<option value="option 2">option 2</option>
						
						<option value="option 3">option 3</option>
						
						<option value="option 4">option 4</option>
						
					</select>
				</div>
								
				<div class="filter_form_field">
					<label for="filterUserAuthor">User/Author:</label>
					<select id="filterUserAuthor" class="filter_form_field_userauthor">
						<option value="" id="All">All</option>
						
						<option value="option 0">option 0</option>
						
						<option value="option 1">option 1</option>
						
						<option value="option 2">option 2</option>
						
						<option value="option 3">option 3</option>
						
						<option value="option 4">option 4</option>
						
					</select>
				</div>
				
				<div class="filter_form_btns">
					<input type="submit" class="filter_form_btn_filter" value="Filter" />
					<input type="reset" class="filter_form_btn_clear" value="Clear" />
				</div>
				
				<div class="clear"></div>
			</div>
		</div>
		
		{% autopaginate visualizations 8 %}

		<!-- results_pagination -->
		<div class="results_pagination">
			<div class="tags"><span class="tag_title">You are viewing:</span> <span class="tag">All Topics</span> <span class="tag">All Geographic Data Levels</span></div>
			<div class="results"><strong>{{ nr_results }}</strong> Results</div>

			{% paginate using 'mbdc/_pagination.html' %}

			<div class="clear"></div>
		</div>
		<!-- /results_pagination -->
		
	</div>
</div>
<!-- /results_filter_multiline -->

				
				
<!-- vis_box_listing -->
<div class="vis_box_listing">
	<div class="vis_box_listing_pad">
		
		{% for visualization in visualizations %}

		<div class="vis_box_item">
			<div class="vis_box_image"><a href="{{ visualization.get_absolute_url }}" title="{{ visualization.title }}"><img src="{{ MEDIA_URL }}weave_thumbnails/{{ visualization.id }}_gallery.png" alt="{{ visualization.title }}" /></a></div>
			<div class="vis_box_title"><a href="{{ visualization.get_absolute_url }}" class="title">{{ visualization.title }}</a>, <span class="date">{{ visualization.year }}</span></div>
			<div class="vis_box_abstract">{{ visualization.abstract|truncatewords:8 }}</div>
			<div class="vis_box_author">By <a href="{{ visualization.owner.get_profile.get_absolute_url }}" class="author">{% firstof visualization.owner.get_profile.name visualization.owner.username %}</a></div>
		</div>

		{% endfor %}

		<div class="clear"></div>
	</div>
</div>
<!-- /vis_box_listing -->

				
				
<!-- results_pagination_bottom -->
<div class="results_pagination_bottom">
	<div class="results"><strong>{{ nr_results }}</strong> Results</div>
	{% paginate using 'mbdc/_pagination.html' %}
	<div class="clear"></div>
</div>
<!-- /results_pagination_bottom -->

				
			</div>
		</div>
		<!-- /site_body -->

	
{% endblock body %}

{% block extra_javascript %}

{{ block.super }}

{% include "weave/_swfobject.html" %}

<script type="text/javascript">

jQuery(document).ready(function($) {

	/* 
	* Render selected visualization
	*/
	$(".vis_change").change(function() {

		// only if something other than the first (empty) is selected
		if ($(this).prop("selectedIndex") !== 0) {

			// flash-object-id|FlashVars-file-value|title|year|sources
			var vis_args = $("option:selected", this)
				.val()
				.split("|");

			var weave = swfobject.getObjectById(vis_args[0]);

			$.get(vis_args[1], function(xmlData){

				// XML to string conversion
				// TODO make function globally available
				function XMLToString(oXML) {
					if (window.ActiveXObject) {
						return oXML.xml;
					} else {
						return (new XMLSerializer()).serializeToString(oXML);
					}
				}

				// Weave API method only accepts strings
				var data = XMLToString(xmlData);
				var sessionstate = weave.convertSessionStateXMLToObject(data);
				weave.setSessionState([], sessionstate);

				// session state cosmetics
				weave.setSessionState(['WeaveProperties'], { 
					backgroundColor: "16777215", // white
					dashboardMode: true, 
					enableMenuBar: false,
					enableToolControls: false ,
					showCopyright: false
				});

				// update title, years and source
				$("#" + vis_args[0] + "-meta .title")
					.html("<a href=''>" + vis_args[2] + "</a>");
				$("#" + vis_args[0] + "-meta .info")
				 	.html("Year(s): " + vis_args[3] + "  <span class='spacer'>&#8226;</span>  Source: " + vis_args[4]);		
			});
		}
	});

});
	  
</script>

{% endblock extra_javascript %}